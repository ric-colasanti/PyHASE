<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Latest compiled and minified CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <title>Bhar</title>


  <style>
    .scroller {
      height: 600px;
      overflow: scroll;
      overflow-x: hidden;
    }

    .ref {
        font-size: x-small;
        font-style: italic;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-sm bg-light navbar-light fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Bhar</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="collapsibleNavbar">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="#model">Model</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container pt-5" style="margin-top:80px">
    <div class="model-area" id="model">
      <h2>Exploiting Social Networks to Mitigate the Obesity Epidemic</h2>
      <div class="ref">Bahr, David B., et al. "Exploiting social networks to mitigate the obesity epidemic." Obesity 17.4 (2009): 723-728.</div>
      <br>
      <div class="row">
        <div class="col-sm-4">
          <div class="col-sm-4 bgDemo">


            <button  class="btn btn-primary tablinks" onclick="openCity(event, 'Grid')">Grid</button>
            <button  class="btn btn-primary tablinks" onclick="openCity(event, 'Graph')">Graph</button>

            <br>
            <div id="Grid" class="tabcontent active" style="display: block;">
              <br>
              <canvas id="canvas" width="340" height="340"></canvas>
            </div>

            <div id="Graph" class="tabcontent" style="display: none;">
              <div id="myPlot" style="width:340px"></div>
            </div>


            <div class="form-check">
              <div class="slidecontainer">
                Healthy weight <input type="range" min="1" max="100" value="30" class="slider" id="healthy">
                Over weight <input type="range" min="1" max="100" value="36" class="slider" id="over">
                Obese <input type="range" min="1" max="100" value="34" class="slider" id="obese">
                Speed <input type="range" min="1" max="100" value="2" class="slider" id="speed">
              </div>
              <input class="form-check-input" type="checkbox" id="check1" name="option1" unchecked>
              <label class="form-check-label" style="width: 200px;">Lock 50 healthy</label>
              <button id="run" class="btn btn-primary mt-3">Run</button>
            </div>

          </div>
        </div>

        <div class="col-sm-8 bgTextBox bg-light text-dark scroller">
          <h5>Why is this a good example</h5>
          <p>This is a very good model to understand network theory.</p>
          <p> One of the most important features of ABM is the
            way in which the agents interact with each other. In this model a population's social network is created by
            forming links between agents. The agent to agent links represent connections between a person and their
            friends. In this model this friendship network is used to simulate the effect that a person's friends have
            on their body weight. This abstract model shows that the structure of that network is very important in
            determining the behaviour of the model.</p>

          <h5>What is the NCD prevention challenge being addressed?</h5>
          <p>This model is concerned with obesity.</p>
          <p>Between 1971 and 2003 the population of the city of Framingham was part of a cardiac health study where
            12,067 people's health data were repeatedly collected. A long term analysis of the weight data and the
            friendship network of the population by Christakis and Fowler showed that a personâ€™s chances of becoming
            obese increased by almost 70% if he or she had a friend who became obese. In the social network of the
            Framingham heart study described by Christakis and Fowler the nodes are the people in the study and the
            edges are the relationships between the people. These relationships are friends, family and coworkers.
            Networks are found throughout nature and society. Despite their apparent random appearance network theory
            can be applied to these networks to identify common patterns and behaviours. Using network theory,
            artificial networks of social interactions can be constructed that have the same important characteristics
            of real social networks. These artificial networks can then be used to simulate how obesity spreads along
            social networks and to test the effectiveness of population level weight management interventions.</p>

          <h5>How is ABM suited to address this challenge?</h5>

          <h5>What are the key components of the model?</h5>

          <h5>How does the model work?</h5>

          <h5>What are the key findings from the model?</h5>

          <h5>What are the implications of these findings for policy or practice?</h5>

          <p>
            Links [need to make sure all outputs/links are open access]
            Primary paper
            Model code
            Other references
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Latest compiled JavaScript -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/ABM.js"></script>

  <script>

    var size = 40
    var caCanvas = new CACanvas(size)
    var flag = false;
    var nextTime = 0;
    var delay = 1000;
    var healthy = document.getElementById("healthy");
    var over = document.getElementById("over");
    var obese = document.getElementById("obese");
    var speed = document.getElementById("speed");



    class Person extends Agent {
      constructor(state) {
        super();
        this.state = state;
        this.locked = false;
      }

      update() {
        var count = [0, 0, 0]
        var select = []
        var c = 0
        this.links.forEach(function (link, index) {
          count[link.state] += 1
        });
        var max = Math.max.apply(Math, count);
        if (max == count[0]) {
          select.push(0)
        }
        if (max == count[1]) {
          select.push(1)
        }
        if (max == count[2]) {
          select.push(2)
        }

        var nstate = this.state;
        this.state = select[rndInt(select.length)];
        return nstate != this.state;
      }
    }








    setup = function () {
      population = new Agents()
      var h = Number(healthy.value)
      var o = Number(over.value)
      var b = Number(obese.value)
      var atype = 2
      var t = h + o + b;
      place = new Patches(size)
      for (i = 0; i < size * size; i++) {
        var patch = new Patch();
        var choice = rndInt(t)
        if (choice <= h) {
          atype = 0;
        }
        if ((choice > h) && (choice <= (h + o))) {
          atype = 1;
        }
        if (choice > (h + o)) {
          atype = 2;
        }
        var agent = new Person(atype)
        patch.addAgent(agent);
        population.addAgent(agent);
        place.addPatch(patch);
      }
      const checked = document.querySelector('#check1:checked') !== null
      if (checked == true) {
        var l = population.list.length;
        var lock = 50
        while (lock > 0) {
          var person = population.list[rndInt(population.list.length - 1)]
          if (person.state == 0 && person.locked == false) {
            person.locked = true;
            lock--;
          }
        }
      }
      place.setNeighbors()
      place.list.forEach(function (patch, index) {
        var aperson = patch.occupant
        if (aperson != null) {
          aperson.home.neighbors.forEach(function (npatch, i) {
            if (npatch.occupant != null) {
              aperson.addLink(npatch.occupant)
            }
          })
        }
      });
    }


    draw = function () {
      var flag = false;
      place.list.forEach(function (patch, index) {
        var person = patch.occupant
        var col = "#000000";
        // if (person != null) {
        if (person.links.length > 0) {
          switch (person.state) {
            case 0:
              col = "#00ff00";
              break;
            case 1:
              col = "#0000ff";
              break;
            case 2:
              col = "#ff0000";
              break;

            default:
              col = "#000000";
          }
          var bCol = "#000000";
          if (person.locked) {
            bCol = "#ffffff";
          }
          caCanvas.draw(patch.xPos, patch.yPos, bCol, true, col);
        }
      })
      caCanvas.update("canvas");
    }



    update = function () {
      var changes = 0
      draw()
      population.shuffle();
      var h = 0;
      var o = 0;
      var b = 0;
      population.list.forEach(function (person, index) {
        if (person.locked == false) {
          if (person.update()) {
            changes++
          }
          if (person.state == 0) {
            h++;
          }
          if (person.state == 1) {
            o++;
          }
          if (person.state == 2) {
            b++;
          }
        }
      });
      var xArray = ["Healthy", "Overweight", "Obese"];
      var yArray = [h, o, b];

      var data = [{
        x: xArray,
        y: yArray,
        color: ['green','blue','red'],
        type: "bar"
      }];

      var layout = { title: "Weight types" };

      Plotly.newPlot("myPlot", data, layout);
      if (changes > 0) {
        setTimeout(function () {
          window.requestAnimationFrame(update);
        }, 1000 / Number(speed.value));

      } else {
        console.log("DONE");
      }
    }


    go = function () {
      if (flag == true) {
        setup();
      }
      flag = true;
      update()
    }



    setup();
    draw();
    var btn = document.getElementById("run");
    btn.addEventListener("click", go);


    function openCity(evt, cityName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(cityName).style.display = "block";
      evt.currentTarget.className += " active";
    }
  </script>

</body>

</html>