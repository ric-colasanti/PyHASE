<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">

  <title>Bhar</title>


  <style>
    .scroller {
      height: 700px;
      overflow: scroll;
      overflow-x: hidden;
    }

    .ref {
        font-size: x-small;
        font-style: italic;
    }
    /* .card-link {
      color:black;
    } */
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-sm bg-light navbar-light fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Bhar</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="collapsibleNavbar">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="#model">Model</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
 
  <div class="container" style="margin-top:80px">
    <!-- <a href="#test">test</a>  -->
    <div class="model-area" id="model">
      <h2>Exploiting Social Networks to Mitigate the Obesity Epidemic</h2>
      <div class="ref">Bahr, David B., et al. "Exploiting social networks to mitigate the obesity epidemic." Obesity 17.4 (2009): 723-728.</div>
      <br>
      <div class="row">
        <div class="col-sm-4">
         


            <button  class="btn btn-primary tablinks" onclick="openCity(event, 'Grid')">Grid</button>
            <button  class="btn btn-primary tablinks" onclick="openCity(event, 'Graph')">Graph</button>

            <br>
            <div id="Grid" class="tabcontent active" style="display: block;">
              <br>
              <p align="center">
                <canvas id="canvas" width="250" height="250"></canvas>
              </p>
              
            </div>

            <div id="Graph" class="tabcontent" style="display: none;">
              <p align="center">
                <div id="myPlot" style="width:350px"></div>
              </p>
            </div>


            <div class="form-check">
              <div class="slidecontainer">
                 <span style="color:rgb(0, 255, 0);">   &#9679;</span> Healthy weight <input type="range" min="1" max="100" value="30" class="slider" id="healthy">
                <br>
               <span style="color:blue">   &#9679;</span> Over weight <input type="range" min="1" max="100" value="36" class="slider" id="over">
                <br>
                 <span style="color:red">   &#9679;</span> Obese <input type="range" min="1" max="100" value="34" class="slider" id="obese">
                <br>
                Random links <input type="range" min="0" max="3000" value="0" class="slider" id="rlinks">
                <br>
                Speed <input type="range" min="1" max="100" value="2" class="slider" id="speed">
              </div>
              <br>
              <input class="form-check-input" type="checkbox" id="check1" name="option1" unchecked>
              <br>
              <label class="form-check-label" >Lock 50 <span style="color:rgb(0, 255, 0); background-color: orange;">   &#9679;</span> healthy</label>
              <br>
              <button id="run" class="btn btn-primary mt-3">Run</button>
            </div>

          
        </div>
        
        <div class="col-sm-8  ">
          <div id="accordion">
            <div class="card">
              <div class="card-header">
                <a class="card-link" data-toggle="collapse" href="#collapseOne">
                  Why is this a good example
                </a>
              </div>
              <div id="collapseOne" class="collapse show" data-parent="#accordion">
                <div class="card-body ">
                  <p>This is a very good model to understand network theory.</p>
          <p> One of the most important features of ABM is the
            way in which the agents interact with each other. In this model a population's social network is created by
            forming links between agents. The agent to agent links represent connections between a person and their
            friends. In this model this friendship network is used to simulate the effect that a person's friends have
            on their body weight. This abstract model shows that the structure of that network is very important in
            determining the behaviour of the model.</p>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-header">
                <a class="collapsed card-link" data-toggle="collapse" href="#collapseTwo">
                  What is the NCD prevention challenge being addressed?
              </a>
              </div>
              <div id="collapseTwo" class="collapse" data-parent="#accordion">
                <div class="card-body">
                  <p>This model is concerned with obesity.</p>
                  <p>Between 1971 and 2003 the population of the city of Framingham was part of a cardiac health study where
                    12,067 people's health data were repeatedly collected. A long term analysis of the weight data and the
                    friendship network of the population by Christakis and Fowler showed that a person’s chances of becoming
                    obese increased by almost 70% if he or she had a friend who became obese. In the social network of the
                    Framingham heart study described by Christakis and Fowler the nodes are the people in the study and the
                    edges are the relationships between the people. These relationships are friends, family and coworkers.
                    Networks are found throughout nature and society. Despite their apparent random appearance network theory
                    can be applied to these networks to identify common patterns and behaviours. Using network theory,
                    artificial networks of social interactions can be constructed that have the same important characteristics
                    of real social networks. These artificial networks can then be used to simulate how obesity spreads along
                    social networks and to test the effectiveness of population level weight management interventions.</p>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-header">
                <a class="collapsed card-link" data-toggle="collapse" href="#collapseThree">
                  How is ABM suited to address this challenge?
                </a>
              </div>
              <div id="collapseThree" class="collapse" data-parent="#accordion">
                <div class="card-body">
                  <p>What the Bhar paper shows is that differing connections at the individual will produce different outcomes at the population level. An agent based model allows you to model a range of personal interactions and observe how these affect the behaviour of the population as a whole. Some small changes in individual behaviour result in  totally different outcomes. In the simulation see what happens when you lock in just 50 individuals to a healthy weight.  Mathematical or statistical models of whole populations can not capture this emergent “phase change”. In the context of the management of obesity it means we can test different individual interventions. 
                  </p>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-header">
                <a class="collapsed card-link" data-toggle="collapse" href="#collapseFour">
                  What are the key components of the model?
                </a>
              </div>
              <div id="collapseFour" class="collapse" data-parent="#accordion">
                <div class="card-body">
                  <p>The simulation models a population of individual agents (people) that are represented as different colored  dots on the grid. Each agent can be in one of three weight states: healthy weight (green) over weight (blue) and obese (red). In this version of the Bhar model each agent occupies an individual space on a 40 by 40 grid. Each agent has a social network consisting of the agents eight immediate neighbors on the grid. With in any iteration step of the simulation an agent will change its weight state to be that of the majority state of its social networked neighbors.</p>
                  <p>Because the agents are linked together in a grid like network it means that all of the agents have two friends in common with that agent, although note that these will be two different friends for each agent.  This results in a network that has a high clustering coefficient. The effect of this can be seen in the relatively stable clustering of weight type when the simulation is run. The number of common friends, and thus the clustering coefficient can be reduced by adding random links. This is done with the random link slider. Keeping every thing else the same see how the behavior of the simulation change.</p> 
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <a class="collapsed card-link" data-toggle="collapse" href="#collapseFive">
                  How does the model work?
                </a>
              </div>
              <div id="collapseFive" class="collapse" data-parent="#accordion">
                <div class="card-body">
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                </div>
              </div>
            </div>
          
            <div class="card">
              <div class="card-header">
                <a class="collapsed card-link" data-toggle="collapse" href="#collapseSeven">
                  What are the implications of these findings for policy or practice?
                </a>
              </div>
              <div id="collapseSeven" class="collapse" data-parent="#accordion">
                <div class="card-body">
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                </div>
              </div>
            </div>
          
            <div class="card">
              <div class="card-header">
                <a class="collapsed card-link" data-toggle="collapse" href="#collapseEight">
                  Links
                </a>
              </div>
              <div id="collapseEight" class="collapse" data-parent="#accordion">
                <div class="card-body">
                  Primary paper
                  Model code
                  Other references
                </div>
              </div>
            </div>
          
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Latest compiled JavaScript -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/ABM.js"></script>

  <script>

    var size = 40
    var caCanvas = new CACanvas(size)
    var flag = false;
    var nextTime = 0;
    var delay = 1000;
    var healthy = document.getElementById("healthy");
    var over = document.getElementById("over");
    var obese = document.getElementById("obese");
    var speed = document.getElementById("speed");
    var rlinks = document.getElementById("rlinks");



    class Person extends Agent {
      constructor(state) {
        super();
        this.state = state;
        this.locked = false;
      }

      update() {
        var count = [0, 0, 0]
        var select = []
        var c = 0
        this.links.forEach(function (link, index) {
          count[link.state] += 1
        });
        var max = Math.max.apply(Math, count);
        if (max == count[0]) {
          select.push(0)
        }
        if (max == count[1]) {
          select.push(1)
        }
        if (max == count[2]) {
          select.push(2)
        }

        var nstate = this.state;
        this.state = select[rndInt(select.length)];
        return nstate != this.state;
      }
    }








    setup = function () {
      population = new Agents()
      var h = Number(healthy.value)
      var o = Number(over.value)
      var b = Number(obese.value)
      var atype = 2
      var t = h + o + b;
      place = new Patches(size)
      for (i = 0; i < size * size; i++) {
        var patch = new Patch();
        var choice = rndInt(t)
        if (choice <= h) {
          atype = 0;
        }
        if ((choice > h) && (choice <= (h + o))) {
          atype = 1;
        }
        if (choice > (h + o)) {
          atype = 2;
        }
        var agent = new Person(atype)
        patch.addAgent(agent);
        population.addAgent(agent);
        place.addPatch(patch);
      }
      const checked = document.querySelector('#check1:checked') !== null
      if (checked == true) {
        var l = population.list.length;
        var lock = 50
        while (lock > 0) {
          var person = population.list[rndInt(population.list.length - 1)]
          if (person.state == 0 && person.locked == false) {
            person.locked = true;
            lock--;
          }
        }
      }
      place.setNeighbors()
      place.list.forEach(function (patch, index) {
        var aperson = patch.occupant
        if (aperson != null) {
          aperson.home.neighbors.forEach(function (npatch, i) {
            if (npatch.occupant != null) {
              aperson.addLink(npatch.occupant)
            }
          })
        }
      });
      for( var i=0; i<rlinks.value;i++){
        var t = population.list[rndInt(40*40)]
        var f = population.list[rndInt(40*40)]
        t.addLink(f);
        f.addLink(t);
      }
    }


    draw = function () {
      place.list.forEach(function (patch, index) {
        var person = patch.occupant
        var col
        if (person.links.length > 0) {
          switch (person.state) {
            case 0:
              col = "#00ff00";
              break;
            case 1:
              col = "#0000ff";
              break;
            case 2:
              col = "#ff0000";
              break;

            default:
              col = "#000000";
          }
          var bCol = "#000000";
          if (person.locked) {
            bCol = "#FFA500";
          }
          caCanvas.draw(patch.xPos, patch.yPos, bCol, true, col);
        }
      })
      caCanvas.update("canvas");
    }



    update = function () {
      var changes = 0
      draw()
      population.shuffle();
      var h = 0;
      var o = 0;
      var b = 0;
      population.list.forEach(function (person, index) {
        if (person.locked == false) {
          if (person.update()) {
            changes++
          }
          if (person.state == 0) {
            h++;
          }
          if (person.state == 1) {
            o++;
          }
          if (person.state == 2) {
            b++;
          }
        }
      });
      var xArray = ["Healthy", "Overweight", "Obese"];
      var yArray = [h, o, b];

      var data = [{
        x: xArray,
        y: yArray,
        colors: ['green','blue','red'],
        type: "bar"
      }];

      var layout = { title: "Weight types" };

      Plotly.newPlot("myPlot", data, layout);
      if (changes > 0) {
        setTimeout(function () {
          window.requestAnimationFrame(update);
        }, 1000 / Number(speed.value));

      } else {
        console.log("DONE");
      }
    }


    go = function () {
      if (flag == true) {
        setup();
      }
      flag = true;
      update()
    }



    setup();
    draw();
    var btn = document.getElementById("run");
    btn.addEventListener("click", go);


    function openCity(evt, cityName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(cityName).style.display = "block";
      evt.currentTarget.className += " active";
    }
  </script>

</body>

</html>