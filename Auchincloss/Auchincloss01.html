<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">

    <title>Bhar</title>


    <style>
        .scroller {
            height: 700px;
            overflow: scroll;
            overflow-x: hidden;
        }

        .ref {
            font-size: x-small;
            font-style: italic;
        }

        /* .card-link {
      color:black;
    } */
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-sm bg-light navbar-light fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Bhar</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#model">Model</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top:80px">
        <!-- <a href="#test">test</a>  -->
        <div class="model-area" id="model">
            <h2>An Agent-Based Model of Income Inequalities in Diet in the
                Context of Residential Segregation</h2>
            <div class="ref">Auchincloss, Amy H., et al. "An agent-based model of income inequalities in diet in the context of residential segregation." American journal of preventive medicine 40.3 (2011): 303-311.</div>
            <br>
            <div class="row">
                <div class="col-sm-5">


                    <div class="row">
                        <div class="col" align="center">
                            <button class="btn btn-primary tablinks" onclick="openCity(event, 'Grid')">Grid</button>
                        </div>
                        <div class="col" align="center">
                            <button class="btn btn-primary tablinks" onclick="openCity(event, 'Graph')">Graph</button>
                        </div>
                    </div>

                    <div id="Grid" class="tabcontent active" style="display: block;">
                        <br>
                        <p align="center">
                            <canvas id="canvas" width="280" height="280"></canvas>
                        </p>

                    </div>

                    <div id="Graph" class="tabcontent" style="display: none;">
                        <p align="left">
                            <div id="myPlot" style="width:350px"></div>
                        </p>
                    </div>


                    <div class="form-check">
                        <div class="slidecontainer">
                            <div class="row">
                                <div class="col"><span style="color:rgb(0, 255, 0); background-color: black;">
                                        &#9679;</span> Healthy
                                </div>
                                <div class="col"><input type="range" min="1" max="100" value="30" class="slider"
                                        id="healthy"></div>
                            </div>
                            <div class="row">
                                <div class="col"><span style="color:DodgerBlue; background-color: black;">
                                        &#9679;</span> Over </div>
                                <div class="col"><input type="range" min="1" max="100" value="30" class="slider"
                                        id="over"></div>
                            </div>
                            <div class="row">
                                <div class="col"> <span style="color:red; background-color: black;"> &#9679;</span>
                                    Obese </div>
                                <div class="col"><input type="range" min="1" max="100" value="30" class="slider"
                                        id="obese"></div>
                            </div>
                            <div class="row">
                                <div class="col">Random links</div>
                                <div class="col"><input type="range" min="0" max="3000" value="0" class="slider"
                                        id="rlinks"></div>
                            </div>
                            <div class="row">
                                <div class="col">Speed </div>
                                <div class="col"> <input type="range" min="1" max="100" value="2" class="slider"
                                        id="speed"></div>
                            </div>
                        </div>
                        <br>
                        <input class="form-check-input" type="checkbox" id="check1" name="option1" unchecked>
                        <label class="form-check-label">Lock 50 <span
                                style="color:rgb(0, 255, 0); background-color: orange;">
                                &#9679;</span> healthy</label>
                    </div>


                    <br>
                    <div class="row">
                        <div class="col" align="center"><button id="setup" class="btn btn-primary mt-3">Setup</button>
                        </div>
                        <div class="col" align="center"><button id="run" class="btn btn-primary mt-3">Run</button></div>
                        <div class="col" align="center"><button id="stop" class="btn btn-primary mt-3">Stop</button>
                        </div>
                    </div>

                </div>


                <div class="col-sm-7  ">
                    <p>Lorem ipsum dolor sit amet, laboris do enim cupidatat velit velit et. Ullamco quis nostrud esse excepteur amet deserunt dolor Lorem culpa eu deserunt. Anim consequat laborum Lorem aliqua ea cupidatat id qui commodo elit eu ad pariatur. Nostrud labore minim quis laborum commodo nisi et aute velit nulla eiusmod. Reprehenderit quis aliqua irure id esse aliquip tempor reprehenderit magna. Adipisicing aliquip ex elit Lorem eu elit amet consectetur cillum ad cupidatat minim minim esse ullamco et aliquip do do. Aute officia mollit reprehenderit ex aliqua esse dolore culpa culpa minim non. Ut laborum minim nostrud excepteur ex veniam cupidatat. Est consequat amet ullamco exercitation aliquip culpa adipisicing. Aute aliqua velit voluptate id tempor fugiat incididunt.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Latest compiled JavaScript -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/ABM.js"></script>

    <script>
        var size = 40
        var caCanvas = new CACanvas(size)
        



        class Person extends Agent {
            constructor(income) {
                this.income = income
                this.previousVisits = [null,null,null,null,null]
                super();
            }

            update() {

            }
        }

        class Place extends Patch {
            constructor(state) {
                super();
                this.occupant = []
            }

            addAgent(agent) {
                this.occupant.push(agent);
                agent.home = this;
            }
            
            distance(place){
                var xDif = Math.abs(this.xPos - place.xPos)
                var yDif = Math.abs(this.yPos - place.yPos)
                return Math.sqrt(Math.pow(xDif,2)+Math.pow(yDif,2))
            }
        }
                
    

        setup = function () {
            population = new Agents()
            place = new Patches(size)
            for (i = 0; i < size * size; i++) {
                var place = new Place();
                var person = new Person(atype)
                plasce.addAgent(person);
                population.addAgent(person);
                place.addPatch(patch);
            }
            const checked = document.querySelector('#check1:checked') !== null
            if (checked == true) {
                var l = population.list.length;
                var lock = 50
                while (lock > 0) {
                    var person = population.list[rndInt(population.list.length - 1)]
                    if (person.state == 0 && person.locked == false) {
                        person.locked = true;
                        lock--;
                    }
                }
            }
            place.setNeighbors()
            place.list.forEach(function (patch, index) {
                var aperson = patch.occupant
                if (aperson != null) {
                    aperson.home.neighbors.forEach(function (npatch, i) {
                        if (npatch.occupant != null) {
                            aperson.addLink(npatch.occupant)
                        }
                    })
                }
            });
            for (var i = 0; i < rlinks.value; i++) {
                var t = population.list[rndInt(40 * 40)]
                var f = population.list[rndInt(40 * 40)]
                t.addLink(f);
                f.addLink(t);
            }
            draw()
        }


        draw = function () {
            place.list.forEach(function (patch, index) {
                var person = patch.occupant
                var col
                if (person.links.length > 0) {
                    switch (person.state) {
                        case 0:
                            col = "#00ff00";
                            break;
                        case 1:
                            col = "DodgerBlue";
                            break;
                        case 2:
                            col = "#ff0000";
                            break;

                        default:
                            col = "#000000";
                    }
                    var bCol = "#000000";
                    if (person.locked) {
                        bCol = "#FFA500";
                    }
                    caCanvas.draw(patch.xPos, patch.yPos, bCol, true, col);
                }
            })
            caCanvas.update("canvas");
            console.log("draw");
        }



        update = function () {
            var changes = 0
            draw()
            population.shuffle();
            var h = 0;
            var o = 0;
            var b = 0;
            population.list.forEach(function (person, index) {
                if (person.locked == false) {
                    if (person.update()) {
                        changes++
                    }
                    if (person.state == 0) {
                        h++;
                    }
                    if (person.state == 1) {
                        o++;
                    }
                    if (person.state == 2) {
                        b++;
                    }
                }
            });
            var xArray = ["Healthy", "Overweight", "Obese"];
            var yArray = [h, o, b];

            var data = [{
                x: xArray,
                y: yArray,
                colors: ['green', 'blue', 'red'],
                type: "bar"
            }];

            var layout = {
                title: "Weight types"
            };

            Plotly.newPlot("myPlot", data, layout);
            if ((changes > 0) && (flag == true)) {
                console.log(flag);
                setTimeout(function () {
                    window.requestAnimationFrame(update);
                }, 1000 / Number(speed.value));

            } else {
                console.log("DONE");
            }
        }

        stop = function () {
            flag = false;
            console.log(flag);
        }
        go = function () {
            flag = true;
            update()
        }



        setup();
        draw();
        test = function () {
            console.log("test");
        }
        var runBtn = document.getElementById("run");
        runBtn.addEventListener("click", go);
        var setupBtn = document.getElementById("setup");
        setupBtn.addEventListener("click", setup);
        var stopBtn = document.getElementById("stop");
        stopBtn.addEventListener("click", stop);

        function openCity(evt, cityName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>

</body>

</html>